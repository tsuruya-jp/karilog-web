# Karilog Web 画面設計書

## 概要

本ドキュメントでは、Karilog Webの各画面のレイアウト、UIコンポーネント、ユーザーフローを定義します。

---

## 共通レイアウト

### 認証前レイアウト

```
┌─────────────────────────────────────┐
│         Karilog ロゴ                │
│                                     │
│                                     │
│        [コンテンツエリア]           │
│                                     │
│                                     │
└─────────────────────────────────────┘
```

### 認証後レイアウト

```
┌─────────────────────────────────────┐
│ ☰  Karilog     通知  ユーザー ▼    │ ← ヘッダー
├────────┬────────────────────────────┤
│        │                            │
│        │                            │
│ サイド │    メインコンテンツ        │
│ バー   │                            │
│        │                            │
│        │                            │
└────────┴────────────────────────────┘
```

**ヘッダー**:
- ロゴ（クリックでダッシュボードへ）
- 通知アイコン（在庫警告、上限超過等）
- ユーザードロップダウン（アカウント設定、ログアウト）

**サイドバー**:
- ダッシュボード
- 実包管理
  - 在庫一覧
  - 購入記録
  - 使用記録
  - 種別管理
  - 上限設定
- 出猟管理
  - カレンダー
  - 記録一覧
  - 統計
- 銃砲管理
- 帳簿出力
- 設定

---

## 認証系画面

### 1. ログイン画面 (`/login`)

```
┌─────────────────────────────────────┐
│            Karilog                  │
│                                     │
│  ┌───────────────────────────────┐  │
│  │ ログイン                      │  │
│  │                               │  │
│  │ メールアドレス                │  │
│  │ [____________________]        │  │
│  │                               │  │
│  │ パスワード                    │  │
│  │ [____________________] [👁]   │  │
│  │                               │  │
│  │ [  ログイン  ]                │  │
│  │                               │  │
│  │ パスワードを忘れた場合        │  │
│  │ 新規登録はこちら              │  │
│  └───────────────────────────────┘  │
└─────────────────────────────────────┘
```

**要素**:
- メールアドレス入力（type="email"）
- パスワード入力（表示/非表示切り替え）
- ログインボタン（ローディング状態対応）
- パスワードリセットリンク
- 新規登録リンク

**バリデーション**:
- メールアドレス形式チェック
- パスワード未入力チェック

**エラー表示**:
- 認証失敗: 「メールアドレスまたはパスワードが正しくありません」
- アカウントロック: 「アカウントがロックされています。{残り時間}後に再試行してください」
- メール未確認: 「メールアドレスが確認されていません」

---

### 2. ユーザー登録画面 (`/register`)

```
┌─────────────────────────────────────┐
│            Karilog                  │
│                                     │
│  ┌───────────────────────────────┐  │
│  │ 新規登録                      │  │
│  │                               │  │
│  │ ユーザー名                    │  │
│  │ [____________________]        │  │
│  │                               │  │
│  │ メールアドレス                │  │
│  │ [____________________]        │  │
│  │                               │  │
│  │ パスワード                    │  │
│  │ [____________________] [👁]   │  │
│  │ ・8文字以上                   │  │
│  │                               │  │
│  │ [  登録する  ]                │  │
│  │                               │  │
│  │ すでにアカウントをお持ちの方  │  │
│  └───────────────────────────────┘  │
└─────────────────────────────────────┘
```

**要素**:
- ユーザー名入力（任意）
- メールアドレス入力
- パスワード入力（強度インジケーター）
- 登録ボタン
- ログインリンク

**バリデーション**:
- メールアドレス形式
- パスワード8文字以上

**成功時**:
- メール確認案内画面へ遷移
- 「確認メールを送信しました。メールをご確認ください」

---

### 3. メール確認画面 (`/verify-email`)

```
┌─────────────────────────────────────┐
│            Karilog                  │
│                                     │
│  ┌───────────────────────────────┐  │
│  │ ✉️  メールアドレスの確認      │  │
│  │                               │  │
│  │ 確認メールを送信しました。    │  │
│  │ メール内のリンクをクリック    │  │
│  │ してください。                │  │
│  │                               │  │
│  │ メールが届かない場合:         │  │
│  │ [  再送信  ]                  │  │
│  │                               │  │
│  └───────────────────────────────┘  │
└─────────────────────────────────────┘
```

**URLパラメータ処理**:
- `/verify-email?token=xxx` でアクセス時、自動的にAPI呼び出し
- 成功 → ログイン画面へ遷移、成功メッセージ表示
- 失敗 → エラーメッセージ表示、再送信ボタン表示

---

### 4. パスワードリセット要求画面 (`/forgot-password`)

```
┌─────────────────────────────────────┐
│            Karilog                  │
│                                     │
│  ┌───────────────────────────────┐  │
│  │ パスワードリセット            │  │
│  │                               │  │
│  │ 登録済みのメールアドレスを    │  │
│  │ 入力してください。            │  │
│  │                               │  │
│  │ メールアドレス                │  │
│  │ [____________________]        │  │
│  │                               │  │
│  │ [  送信  ]                    │  │
│  │                               │  │
│  │ ログイン画面に戻る            │  │
│  └───────────────────────────────┘  │
└─────────────────────────────────────┘
```

**成功時**:
- 「パスワードリセットメールを送信しました」
- メール確認案内を表示

---

### 5. パスワードリセット画面 (`/reset-password`)

```
┌─────────────────────────────────────┐
│            Karilog                  │
│                                     │
│  ┌───────────────────────────────┐  │
│  │ 新しいパスワードの設定        │  │
│  │                               │  │
│  │ 新しいパスワード              │  │
│  │ [____________________] [👁]   │  │
│  │ ・8文字以上                   │  │
│  │                               │  │
│  │ [  変更する  ]                │  │
│  │                               │  │
│  └───────────────────────────────┘  │
└─────────────────────────────────────┘
```

**URLパラメータ**: `/reset-password?token=xxx`

**成功時**:
- ログイン画面へ遷移
- 「パスワードを変更しました。新しいパスワードでログインしてください」

---

## メイン機能画面

### 6. ダッシュボード (`/`)

```
┌─────────────────────────────────────────────────┐
│ Karilog                    通知  ユーザー ▼     │
├────────┬────────────────────────────────────────┤
│ 📊 ダッ│  ようこそ、{ユーザー名}さん           │
│   シュ │                                        │
│   ボード│  ┌──────────────┐ ┌──────────────┐   │
│        │  │ 実包在庫      │ │ 直近の出猟   │   │
│ 📦 実包 │  │              │ │              │   │
│  ▼在庫 │  │ 12番 7.5号   │ │ 1/25 〇〇山  │   │
│   購入 │  │ 150/800発    │ │              │   │
│   使用 │  │ [詳細]       │ │ [カレンダー] │   │
│   種別 │  └──────────────┘ └──────────────┘   │
│   上限 │                                        │
│        │  ┌──────────────────────────────────┐ │
│ 🗓 出猟 │  │ 最近の購入記録                   │ │
│  ▼カレン│  │ ・1/15 12番 7.5号 100発          │ │
│   ダー │  │ ・1/10 スラッグ弾 25発           │ │
│   記録 │  │                                  │ │
│   統計 │  └──────────────────────────────────┘ │
│        │                                        │
│ 🔫 銃砲 │  ┌──────────────────────────────────┐ │
│        │  │ 最近の使用記録                   │ │
│ 📄 帳簿 │  │ ・1/20 クレー射撃 25発           │ │
│        │  │ ・1/18 〇〇山 10発               │ │
│ ⚙ 設定 │  │                                  │ │
│        │  └──────────────────────────────────┘ │
└────────┴────────────────────────────────────────┘
```

**要素**:
- 実包在庫サマリーカード（上限警告表示）
- 直近の出猟予定カード
- 最近の購入記録リスト（最大5件）
- 最近の使用記録リスト（最大5件）
- 各カードから詳細画面へのリンク

---

### 7. 実包在庫一覧 (`/ammunition-stock`)

```
┌─────────────────────────────────────────────────┐
│ Karilog                    通知  ユーザー ▼     │
├────────┬────────────────────────────────────────┤
│        │  実包在庫一覧                          │
│        │                                        │
│        │  [🔍 検索] [口径でフィルタ ▼]          │
│        │                                        │
│        │  ┌──────────────────────────────────┐ │
│        │  │ 12番 7.5号                       │ │
│        │  │ 現在: 150発 / 上限: 800発        │ │
│        │  │ 譲受可能: 650発                  │ │
│        │  │ ──────────────────               │ │
│        │  │ [150/800] ▓▓▓▓░░░░░░             │ │
│        │  │ 累計購入: 500発 / 累計使用: 350発│ │
│        │  │ [詳細] [購入登録] [使用登録]     │ │
│        │  └──────────────────────────────────┘ │
│        │                                        │
│        │  ┌──────────────────────────────────┐ │
│        │  │ スラッグ弾                       │ │
│        │  │ 現在: 75発 / 上限: 200発         │ │
│        │  │ 譲受可能: 125発                  │ │
│        │  │ ──────────────────               │ │
│        │  │ [75/200] ▓▓▓▓░░░░░░░             │ │
│        │  │ 累計購入: 200発 / 累計使用: 125発│ │
│        │  │ [詳細] [購入登録] [使用登録]     │ │
│        │  └──────────────────────────────────┘ │
└────────┴────────────────────────────────────────┘
```

**要素**:
- 検索ボックス
- 口径フィルタードロップダウン
- 実包種別ごとのカード:
  - 種別名
  - 現在の在庫数 / 上限
  - 譲受可能残数
  - プログレスバー（色: 緑→黄→赤で上限警告）
  - 累計購入・使用数
  - アクションボタン（詳細、購入登録、使用登録）

**プログレスバーの色**:
- 緑: 0-60%
- 黄: 60-80%
- 赤: 80-100%（警告）

---

### 8. 実包購入記録一覧 (`/ammunition-purchases`)

```
┌─────────────────────────────────────────────────┐
│ Karilog                    通知  ユーザー ▼     │
├────────┬────────────────────────────────────────┤
│        │  実包購入記録             [+ 新規登録] │
│        │                                        │
│        │  [期間] [種別] [銃砲] [検索]           │
│        │                                        │
│        │  ┌──────────────────────────────────┐ │
│        │  │ 購入日 │種別  │数量│購入先│金額 │ │
│        │  ├──────────────────────────────────┤ │
│        │  │1/15   │12番  │100 │〇〇店│5,000│ │
│        │  │       │7.5号 │    │      │  円 │ │
│        │  │       │      │    │      │[編集│ │
│        │  ├──────────────────────────────────┤ │
│        │  │1/10   │スラッ│25  │△△店│3,500│ │
│        │  │       │グ弾  │    │      │  円 │ │
│        │  │       │      │    │      │[編集│ │
│        │  └──────────────────────────────────┘ │
│        │                                        │
│        │  [< 前へ] 1/8ページ [次へ >]           │
└────────┴────────────────────────────────────────┘
```

**要素**:
- 新規登録ボタン
- フィルター（期間、種別、銃砲）
- 検索ボックス
- テーブル（購入日、種別、数量、購入先、金額、操作）
- ページネーション

**行操作**:
- 編集ボタン → 編集モーダル/画面
- 削除ボタン → 確認ダイアログ

---

### 9. 実包購入記録登録/編集画面 (`/ammunition-purchases/new`)

```
┌─────────────────────────────────────────────────┐
│ Karilog                    通知  ユーザー ▼     │
├────────┬────────────────────────────────────────┤
│        │  実包購入記録登録                      │
│        │                                        │
│        │  ┌──────────────────────────────────┐ │
│        │  │ 実包種別 *                       │ │
│        │  │ [選択してください ▼]            │ │
│        │  │                                  │ │
│        │  │ 銃砲（任意）                     │ │
│        │  │ [選択してください ▼]            │ │
│        │  │                                  │ │
│        │  │ 購入日 *                         │ │
│        │  │ [____/____/____] 📅             │ │
│        │  │                                  │ │
│        │  │ 購入先 *                         │ │
│        │  │ [____________________]           │ │
│        │  │                                  │ │
│        │  │ 数量 * (発)                      │ │
│        │  │ [________]                       │ │
│        │  │                                  │ │
│        │  │ 金額（任意）(円)                 │ │
│        │  │ [________]                       │ │
│        │  │                                  │ │
│        │  │ 備考（任意）                     │ │
│        │  │ [____________________]           │ │
│        │  │ [____________________]           │ │
│        │  │                                  │ │
│        │  │ [キャンセル] [  登録  ]          │ │
│        │  └──────────────────────────────────┘ │
└────────┴────────────────────────────────────────┘
```

**要素**:
- 実包種別セレクトボックス（必須）
- 銃砲セレクトボックス（任意）
- 購入日デートピッカー（必須）
- 購入先テキスト入力（必須）
- 数量数値入力（必須、1以上）
- 金額数値入力（任意、0以上）
- 備考テキストエリア（任意）
- キャンセル・登録ボタン

**バリデーション**:
- リアルタイムバリデーション
- エラーメッセージをフィールド下に表示

**上限チェック**:
- 登録時に上限超過の場合、警告トースト表示
- 「この購入により許可上限を50発超過します。登録しますか?」
- 警告を無視して登録可能

---

### 10. 出猟カレンダー (`/hunting-calendar`)

```
┌─────────────────────────────────────────────────┐
│ Karilog                    通知  ユーザー ▼     │
├────────┬────────────────────────────────────────┤
│        │  出猟カレンダー           [+ 新規登録] │
│        │                                        │
│        │  [< 2025年1月 >]                       │
│        │                                        │
│        │  ┌──────────────────────────────────┐ │
│        │  │ 日 月 火 水 木 金 土              │ │
│        │  ├──────────────────────────────────┤ │
│        │  │       1  2  3  4                 │ │
│        │  │ 5  6  7  8  9 10 11              │ │
│        │  │12 13 14 15 16 17 18              │ │
│        │  │19 [20][21]22 23 24 25            │ │
│        │  │    ■  □                          │ │
│        │  │26 27 28 29 30 31                 │ │
│        │  └──────────────────────────────────┘ │
│        │                                        │
│        │  ■ 実績  □ 予定                      │
│        │                                        │
│        │  [詳細表示: 月 ▼]                     │
└────────┴────────────────────────────────────────┘
```

**要素**:
- 新規登録ボタン
- 月次カレンダー（FullCalendar使用）
- 予定/実績の色分け表示
  - 実績: 青（塗りつぶし）
  - 予定: 白（枠のみ）
- 日付クリックで登録モーダル表示
- イベントクリックで詳細モーダル表示
- 表示形式切り替え（月、週、日）

**カレンダーイベント**:
- 日付クリック → 新規登録モーダル（その日付が初期値）
- イベントクリック → 詳細表示モーダル（編集・削除可能）
- ドラッグ&ドロップで日付変更（将来実装）

---

### 11. 出猟記録登録/編集モーダル

```
┌─────────────────────────────────────┐
│ 出猟記録登録              [×]       │
├─────────────────────────────────────┤
│                                     │
│ 出猟日 *                            │
│ [2025/01/20] 📅                     │
│                                     │
│ 場所 *                              │
│ [____________________]              │
│                                     │
│ ☐ 予定  ☑ 実績                     │
│                                     │
│ 備考（任意）                        │
│ [____________________]              │
│ [____________________]              │
│                                     │
│ [キャンセル] [  登録  ]             │
└─────────────────────────────────────┘
```

**要素**:
- 出猟日デートピッカー（必須）
- 場所テキスト入力（必須）
- 予定/実績ラジオボタン（デフォルト: 実績）
- 備考テキストエリア（任意）
- キャンセル・登録ボタン

**編集時**:
- 削除ボタンを追加表示
- 削除 → 確認ダイアログ

---

### 12. 帳簿出力画面 (`/reports`)

```
┌─────────────────────────────────────────────────┐
│ Karilog                    通知  ユーザー ▼     │
├────────┬────────────────────────────────────────┤
│        │  帳簿出力                              │
│        │                                        │
│        │  ┌──────────────────────────────────┐ │
│        │  │ 出力形式                         │ │
│        │  │ ☑ PDF  ☐ CSV                    │ │
│        │  │                                  │ │
│        │  │ 対象期間 *                       │ │
│        │  │ [2024/01/01] ～ [2024/12/31]    │ │
│        │  │                                  │ │
│        │  │ 出力内容 *                       │ │
│        │  │ ☑ 実包管理帳簿（購入・使用）     │ │
│        │  │ ☐ 出猟サマリー                   │ │
│        │  │                                  │ │
│        │  │ [  ダウンロード  ]               │ │
│        │  └──────────────────────────────────┘ │
│        │                                        │
│        │  ┌──────────────────────────────────┐ │
│        │  │ CSV個別出力                      │ │
│        │  │ ・実包購入履歴 [ダウンロード]    │ │
│        │  │ ・実包使用履歴 [ダウンロード]    │ │
│        │  │ ・出猟記録 [ダウンロード]        │ │
│        │  └──────────────────────────────────┘ │
└────────┴────────────────────────────────────────┘
```

**要素**:
- 出力形式選択（PDF / CSV）
- 期間指定（開始日・終了日）
- 出力内容チェックボックス
- ダウンロードボタン（ローディング対応）
- CSV個別出力セクション

**ダウンロード処理**:
1. APIリクエスト（期間、形式を指定）
2. Base64データをBlobに変換
3. ファイルダウンロード
4. 成功トースト表示

---

### 13. 銃砲一覧 (`/firearms`)

```
┌─────────────────────────────────────────────────┐
│ Karilog                    通知  ユーザー ▼     │
├────────┬────────────────────────────────────────┤
│        │  銃砲管理                 [+ 新規登録] │
│        │                                        │
│        │  [銃種でフィルタ ▼] [検索]             │
│        │                                        │
│        │  ┌──────────────────────────────────┐ │
│        │  │ 🔫 レミントン M870               │ │
│        │  │ 銃種: 散弾銃                     │ │
│        │  │ 銃番号: 12345678                 │ │
│        │  │ 許可番号: 第1234号               │ │
│        │  │ 口径: 12番                       │ │
│        │  │ 備考: クレー射撃用               │ │
│        │  │ [編集] [削除]                    │ │
│        │  └──────────────────────────────────┘ │
│        │                                        │
│        │  ┌──────────────────────────────────┐ │
│        │  │ 🔫 ブローニング A-BOLT           │ │
│        │  │ 銃種: ライフル                   │ │
│        │  │ 銃番号: 87654321                 │ │
│        │  │ 許可番号: 第5678号               │ │
│        │  │ 口径: .308                       │ │
│        │  │ 備考: 有害鳥獣駆除用             │ │
│        │  │ [編集] [削除]                    │ │
│        │  └──────────────────────────────────┘ │
└────────┴────────────────────────────────────────┘
```

**要素**:
- 新規登録ボタン
- 銃種フィルター
- 検索ボックス
- 銃砲カード（銃種、名称、番号、口径、備考）
- 編集・削除ボタン

---

### 14. アカウント設定 (`/settings/account`)

```
┌─────────────────────────────────────────────────┐
│ Karilog                    通知  ユーザー ▼     │
├────────┬────────────────────────────────────────┤
│        │  アカウント設定                        │
│        │                                        │
│ 🔹アカウ│  ┌──────────────────────────────────┐ │
│   ント │  │ 基本情報                         │ │
│        │  │                                  │ │
│ 🔹パスワ│  │ ユーザー名                       │ │
│   ード │  │ [山田太郎_______________]        │ │
│        │  │                                  │ │
│        │  │ メールアドレス                   │ │
│        │  │ hunter@example.com（変更不可）   │ │
│        │  │                                  │ │
│        │  │ [  保存  ]                       │ │
│        │  └──────────────────────────────────┘ │
│        │                                        │
│        │  ┌──────────────────────────────────┐ │
│        │  │ アカウント削除                   │ │
│        │  │                                  │ │
│        │  │ アカウントを削除すると、全ての   │ │
│        │  │ データが削除されます。           │ │
│        │  │                                  │ │
│        │  │ [  アカウントを削除  ]           │ │
│        │  └──────────────────────────────────┘ │
└────────┴────────────────────────────────────────┘
```

**要素**:
- ユーザー名編集
- メールアドレス表示（変更不可）
- 保存ボタン
- アカウント削除ボタン（確認ダイアログ）

---

### 15. パスワード変更 (`/settings/password`)

```
┌─────────────────────────────────────────────────┐
│ Karilog                    通知  ユーザー ▼     │
├────────┬────────────────────────────────────────┤
│        │  パスワード変更                        │
│        │                                        │
│ 🔹アカウ│  ┌──────────────────────────────────┐ │
│   ント │  │ 現在のパスワード *               │ │
│        │  │ [____________________] [👁]      │ │
│ 🔹パスワ│  │                                  │ │
│   ード │  │ 新しいパスワード *               │ │
│        │  │ [____________________] [👁]      │ │
│        │  │ ・8文字以上                      │ │
│        │  │                                  │ │
│        │  │ [キャンセル] [  変更  ]          │ │
│        │  └──────────────────────────────────┘ │
└────────┴────────────────────────────────────────┘
```

**要素**:
- 現在のパスワード入力（必須）
- 新しいパスワード入力（必須、8文字以上）
- パスワード強度インジケーター
- キャンセル・変更ボタン

**成功時**:
- 「パスワードを変更しました」トースト表示
- フォームをリセット

---

## UI/UXガイドライン

### カラーパレット

```
プライマリー: #0066cc（青）
セカンダリー: #28a745（緑）
警告: #ffc107（黄）
危険: #dc3545（赤）
背景: #f8f9fa（ライトグレー）
テキスト: #212529（ダークグレー）
ボーダー: #dee2e6（グレー）
```

### タイポグラフィ

```
見出し1: 32px, bold
見出し2: 24px, bold
見出し3: 20px, bold
本文: 16px, regular
小文字: 14px, regular
ラベル: 14px, medium
```

### スペーシング

```
XS: 4px
S: 8px
M: 16px
L: 24px
XL: 32px
XXL: 48px
```

### ボタン

```
プライマリー: 青背景、白文字
セカンダリー: 白背景、青枠、青文字
危険: 赤背景、白文字
無効: グレー背景、白文字、クリック不可
```

### フォーム

```
入力フィールド: 白背景、グレー枠、フォーカス時青枠
エラー: 赤枠、赤文字エラーメッセージ
必須: ラベルに * (赤)
```

### トースト通知

```
成功: 緑背景、チェックアイコン
エラー: 赤背景、×アイコン
警告: 黄背景、!アイコン
情報: 青背景、iアイコン
表示位置: 右上
表示時間: 3秒（自動消去）
```

---

## レスポンシブデザイン

### ブレークポイント

```
モバイル: < 768px（将来対応）
タブレット: 768px - 1024px
デスクトップ: > 1024px（優先）
```

### タブレット対応

- サイドバーを折りたたみ可能に
- テーブルをカードレイアウトに変更
- フォントサイズを調整

---

## アクセシビリティ

- キーボードナビゲーション対応
- フォーカスインジケーター明示
- ARIA属性の適切な設定
- カラーコントラスト比4.5:1以上
- スクリーンリーダー対応

---

## 変更履歴

| バージョン | 日付 | 内容 |
|------------|------|------|
| 1.0 | 2025-12-01 | 初版作成 |
